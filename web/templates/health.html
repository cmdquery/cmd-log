{{template "base.html" .}}

{{define "content"}}
<div class="health-page">
    <h2>Health Status</h2>
    
    <div class="health-section">
        <h3>Overall Status</h3>
        <div class="health-status {{.health.status}}">
            <span class="status-indicator {{.health.status}}">●</span>
            <span>{{if eq .health.status "healthy"}}Healthy{{else}}Unhealthy{{end}}</span>
        </div>
        <p>Uptime: {{.health.uptime}}</p>
    </div>
    
    <div class="health-section">
        <h3>Database</h3>
        <div class="health-item">
            <span class="status-indicator {{if .health.database.healthy}}healthy{{else}}error{{end}}">●</span>
            <span>{{if .health.database.healthy}}Healthy{{else}}Unhealthy{{end}}</span>
        </div>
        {{if .health.database.error}}
        <div class="error-message">{{.health.database.error}}</div>
        {{end}}
    </div>
    
    <div class="health-section">
        <h3>Batch Processor</h3>
        <div class="health-item">
            <span class="status-indicator {{if .health.batcher.healthy}}healthy{{else}}error{{end}}">●</span>
            <span>{{if .health.batcher.healthy}}Healthy{{else}}Unhealthy{{end}}</span>
        </div>
        <div class="health-details">
            <p>Current Batch Size: {{.health.batcher.current_batch}}</p>
            <p>Total Processed: <span id="total-processed">{{.health.batcher.total_processed}}</span></p>
            <p>Flush Count: {{.health.batcher.flush_count}}</p>
            <p>Error Count: {{.health.batcher.error_count}}</p>
            <p>Uptime: {{.health.batcher.uptime}}</p>
        </div>
    </div>
    
    <div class="health-section">
        <h3>Configuration</h3>
        <div class="health-details">
            <p>Batch Size: {{.health.config.batch_size}}</p>
            <p>Batch Flush Interval: {{.health.config.batch_flush_interval}}</p>
            <p>Rate Limit Enabled: {{.health.config.rate_limit_enabled}}</p>
            <p>Rate Limit RPS: {{.health.config.rate_limit_rps}}</p>
        </div>
    </div>
    
    <div class="health-actions">
        <button onclick="refreshHealth()" class="btn btn-primary">Refresh</button>
        <button onclick="loadHealthJSON()" class="btn btn-secondary">View JSON</button>
    </div>
</div>

<script>
    // Format number on page load
    document.addEventListener('DOMContentLoaded', function() {
        const totalProcessed = document.getElementById('total-processed');
        if (totalProcessed) {
            const num = parseInt(totalProcessed.textContent);
            totalProcessed.textContent = num.toLocaleString();
        }
    });
    
    function refreshHealth() {
        window.location.reload();
    }
    
    function loadHealthJSON() {
        fetch('/admin/health?format=json')
            .then(response => response.json())
            .then(data => {
                alert(JSON.stringify(data, null, 2));
            })
            .catch(error => {
                alert('Error loading health data: ' + error);
            });
    }
</script>
{{end}}

