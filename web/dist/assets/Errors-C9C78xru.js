import{_ as B,r as d,w as z,c as f,o as p,a as A,b as e,v as Q,d as M,e as W,f as G,g as P,F as R,h as I,n as T,i as J,j as q,k as X,l as Y,t as v,m as Z,p as ee,q as U,s as te,u as oe,x as $}from"./index-BVQZcSNY.js";import{S as ne}from"./StatusToggle-BJbrDQNb.js";const se={class:"search-bar"},le=["placeholder"],ae={__name:"SearchBar",props:{modelValue:String,placeholder:{type:String,default:"Search errors (e.g., is:resolved, environment:production)"}},emits:["update:modelValue","search"],setup(S,{expose:w,emit:g}){const m=S,i=g,r=d(m.modelValue||""),y=d(null);z(()=>m.modelValue,a=>{r.value=a||""});const C=()=>{i("update:modelValue",r.value)},h=()=>{i("search",r.value)},k=()=>{var a;r.value="",i("update:modelValue",""),(a=y.value)==null||a.blur()};return w({focus:()=>{var a;return(a=y.value)==null?void 0:a.focus()}}),(a,b)=>(p(),f("div",se,[A(e("input",{type:"text","onUpdate:modelValue":b[0]||(b[0]=E=>r.value=E),onInput:C,onKeydown:[M(h,["enter"]),M(k,["esc"])],placeholder:S.placeholder,class:"search-input",ref_key:"inputRef",ref:y},null,40,le),[[Q,r.value]]),e("button",{onClick:h,class:"search-button"},"Search")]))}},re=B(ae,[["__scopeId","data-v-67d11b1e"]]),ue={class:"error-table-container"},ie={class:"error-table"},de=["checked"],ce=["onClick"],ve=["checked","onChange"],pe={class:"message-cell"},he={key:0,class:"assignee"},fe={key:1,class:"no-assignee"},ge={key:0,class:"empty-state"},me={__name:"ErrorTable",props:{faults:{type:Array,default:()=>[]},oneHourCounts:{type:Object,default:()=>({})}},emits:["selection-change","status-update"],setup(S,{emit:w}){const g=S,m=w,i=d(new Set),r=W(()=>g.faults.length>0&&i.value.size===g.faults.length),y=()=>{r.value?i.value.clear():g.faults.forEach(l=>i.value.add(l.id)),m("selection-change",Array.from(i.value))},C=l=>{i.value.has(l)?i.value.delete(l):i.value.add(l),m("selection-change",Array.from(i.value))},h=l=>{},k=(l,o)=>{m("status-update",{id:l,resolved:o})},a=(l,o)=>l?l.length>o?l.substring(0,o)+"...":l:"",b=l=>{if(!l)return"";const o=new Date(l),s=new Date-o,c=Math.floor(s/6e4),V=Math.floor(c/60),_=Math.floor(V/24);return c<1?"just now":c<60?`${c}m ago`:V<24?`${V}h ago`:`${_}d ago`},E=l=>g.oneHourCounts[l]||0;return(l,o)=>{const x=G("router-link");return p(),f("div",ue,[e("table",ie,[e("thead",null,[e("tr",null,[e("th",null,[e("input",{type:"checkbox",checked:r.value,onChange:y},null,40,de)]),o[1]||(o[1]=e("th",null,"Error Type",-1)),o[2]||(o[2]=e("th",null,"Location",-1)),o[3]||(o[3]=e("th",null,"Message",-1)),o[4]||(o[4]=e("th",null,"Environment",-1)),o[5]||(o[5]=e("th",null,"1 Hour",-1)),o[6]||(o[6]=e("th",null,"Count",-1)),o[7]||(o[7]=e("th",null,"Last",-1)),o[8]||(o[8]=e("th",null,"Assignee",-1)),o[9]||(o[9]=e("th",null,"Status",-1))])]),e("tbody",null,[(p(!0),f(R,null,I(S.faults,s=>(p(),f("tr",{key:s.id,class:T({"row-selected":i.value.has(s.id)}),onClick:c=>h(s.id)},[e("td",{onClick:o[0]||(o[0]=J(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:i.value.has(s.id),onChange:c=>C(s.id)},null,40,ve)]),e("td",null,[q(x,{to:`/errors/${s.id}`,class:"error-link"},{default:X(()=>[Y(v(s.error_class),1)]),_:2},1032,["to"])]),e("td",null,v(s.location||"unknown"),1),e("td",pe,v(a(s.message,60)),1),e("td",null,[e("span",{class:T(["env-badge",`env-${s.environment}`])},v(s.environment),3)]),e("td",null,v(E(s.id)),1),e("td",null,v(s.occurrence_count),1),e("td",null,v(b(s.last_seen_at)),1),e("td",null,[s.assignee?(p(),f("span",he,v(s.assignee.name||s.assignee.email),1)):(p(),f("span",fe,"â€”"))]),e("td",null,[q(ne,{"model-value":s.resolved,"onUpdate:modelValue":c=>k(s.id,c)},null,8,["model-value","onUpdate:modelValue"])])],10,ce))),128))])]),S.faults.length===0?(p(),f("div",ge," No errors found ")):P("",!0)])}}},ye=B(me,[["__scopeId","data-v-40b452d1"]]),ke={class:"errors-page"},_e={class:"filters-section"},be={class:"quick-filters"},we=["onClick"],Se={class:"filter-controls"},$e={class:"errors-content"},Ce={key:0,class:"loading-state"},Ee={key:1,class:"error-state"},Ve={key:3,class:"pagination"},xe=["disabled"],Ae={class:"pagination-info"},Ue=["disabled"],Te={__name:"Errors",setup(S){const w=d(""),g=d("all"),m=d(""),i=d(""),r=d(""),y=d([]),C=d({}),h=d(0),k=d(50),a=d(0),b=d([]),E=d(null),l=d(!1),o=d(null),x=[{key:"all",label:"All"},{key:"resolved",label:"Resolved"},{key:"unresolved",label:"Unresolved"}],s=t=>{g.value=t,c()},c=async()=>{a.value=0,await _()},V=()=>{c()},_=async()=>{l.value=!0,o.value=null;try{const t=new URLSearchParams;t.append("limit",k.value.toString()),t.append("offset",a.value.toString()),w.value&&t.append("q",w.value),g.value==="resolved"?t.append("q",(t.get("q")||"")+" is:resolved"):g.value==="unresolved"&&t.append("q",(t.get("q")||"")+" -is:resolved"),m.value&&t.append("q",(t.get("q")||"")+` environment:${m.value}`);const n=await $(`/api/v1/faults?${t.toString()}`);y.value=n.faults||[],h.value=n.total||0,await N()}catch(t){console.error("Error loading faults:",t),o.value=t.message||"Failed to load errors",y.value=[],h.value=0}finally{l.value=!1}},N=async()=>{const t={};for(const n of y.value)try{const u=await $(`/api/v1/faults/${n.id}/stats`);t[n.id]=u.one_hour_count||0}catch{t[n.id]=0}C.value=t},F=t=>{b.value=t},L=async({id:t,resolved:n})=>{try{await $(`/api/v1/faults/${t}/${n?"resolve":"unresolve"}`,{method:"POST"}),await _()}catch(u){console.error("Error updating status:",u)}},O=async()=>{if(!r.value||b.value.length===0){r.value="";return}try{for(const t of b.value)r.value==="resolve"?await $(`/api/v1/faults/${t}/resolve`,{method:"POST"}):r.value==="unresolve"?await $(`/api/v1/faults/${t}/unresolve`,{method:"POST"}):r.value==="ignore"?await $(`/api/v1/faults/${t}/ignore`,{method:"POST"}):r.value==="delete"&&await $(`/api/v1/faults/${t}`,{method:"DELETE"});r.value="",b.value=[],await _()}catch(t){console.error("Error performing bulk action:",t)}},H=()=>{a.value>0&&(a.value-=k.value,_())},K=()=>{a.value+k.value<h.value&&(a.value+=k.value,_())},j=()=>{_()},D=t=>{var n;t.key==="/"&&t.target.tagName!=="INPUT"?(t.preventDefault(),(n=E.value)==null||n.focus()):t.key==="u"&&t.ctrlKey?(t.preventDefault(),s("unresolved")):t.key==="r"&&t.ctrlKey?(t.preventDefault(),s("resolved")):t.key==="a"&&t.ctrlKey&&(t.preventDefault(),s("all"))};return Z(()=>{_(),window.addEventListener("keydown",D)}),ee(()=>{window.removeEventListener("keydown",D)}),(t,n)=>(p(),f("div",ke,[e("div",{class:"page-header"},[n[4]||(n[4]=e("h1",{class:"page-title"},"Errors",-1)),e("div",{class:"page-actions"},[e("button",{class:"btn btn-primary",onClick:j},"Refresh")])]),e("div",_e,[q(re,{modelValue:w.value,"onUpdate:modelValue":n[0]||(n[0]=u=>w.value=u),onSearch:V,ref_key:"searchBarRef",ref:E},null,8,["modelValue"]),e("div",be,[(p(),f(R,null,I(x,u=>e("button",{key:u.key,class:T(["filter-btn",{active:g.value===u.key}]),onClick:qe=>s(u.key)},v(u.label),11,we)),64))]),e("div",Se,[A(e("select",{"onUpdate:modelValue":n[1]||(n[1]=u=>m.value=u),onChange:c,class:"filter-select"},[...n[5]||(n[5]=[e("option",{value:""},"Any Environment",-1),e("option",{value:"production"},"production",-1),e("option",{value:"staging"},"staging",-1),e("option",{value:"development"},"development",-1)])],544),[[U,m.value]]),A(e("select",{"onUpdate:modelValue":n[2]||(n[2]=u=>i.value=u),onChange:c,class:"filter-select"},[...n[6]||(n[6]=[e("option",{value:""},"Any Assignee",-1),e("option",{value:"me"},"Me",-1)])],544),[[U,i.value]]),A(e("select",{"onUpdate:modelValue":n[3]||(n[3]=u=>r.value=u),onChange:O,class:"filter-select"},[...n[7]||(n[7]=[te('<option value="" data-v-780458c4>Bulk Actions</option><option value="resolve" data-v-780458c4>Resolve</option><option value="unresolve" data-v-780458c4>Unresolve</option><option value="ignore" data-v-780458c4>Ignore</option><option value="delete" data-v-780458c4>Delete</option>',5)])],544),[[U,r.value]])])]),e("div",$e,[l.value?(p(),f("div",Ce," Loading errors... ")):o.value?(p(),f("div",Ee,[e("p",null,"Error: "+v(o.value),1),e("button",{onClick:_,class:"btn btn-primary"},"Retry")])):(p(),oe(ye,{key:2,faults:y.value,"one-hour-counts":C.value,onSelectionChange:F,onStatusUpdate:L},null,8,["faults","one-hour-counts"])),h.value>0?(p(),f("div",Ve,[e("button",{class:"pagination-btn",disabled:a.value===0,onClick:H}," Previous ",8,xe),e("span",Ae," Showing "+v(a.value+1)+" to "+v(Math.min(a.value+k.value,h.value))+" of "+v(h.value),1),e("button",{class:"pagination-btn",disabled:a.value+k.value>=h.value,onClick:K}," Next ",8,Ue)])):P("",!0)])]))}},Me=B(Te,[["__scopeId","data-v-780458c4"]]);export{Me as default};
