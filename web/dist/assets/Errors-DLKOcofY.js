import{r as d,w as Q,c as h,o as p,a as e,b as A,v as W,d as q,e as G,f as J,g as R,F as B,h as N,n as U,i as M,j as P,k as X,l as F,t as v,m as Y,p as Z,q as D,s as ee,u as te,x as C}from"./index-Bz7zhzoQ.js";import{_ as se}from"./StatusToggle-u0t_eLUt.js";const oe={class:"search-bar"},ne=["placeholder"],le={__name:"SearchBar",props:{modelValue:String,placeholder:{type:String,default:"Search errors (e.g., is:resolved, environment:production)"}},emits:["update:modelValue","search"],setup($,{expose:w,emit:f}){const g=$,i=f,r=d(g.modelValue||""),y=d(null);Q(()=>g.modelValue,a=>{r.value=a||""});const x=()=>{i("update:modelValue",r.value)},m=()=>{i("search",r.value)},b=()=>{var a;r.value="",i("update:modelValue",""),(a=y.value)==null||a.blur()};return w({focus:()=>{var a;return(a=y.value)==null?void 0:a.focus()}}),(a,_)=>(p(),h("div",oe,[_[1]||(_[1]=e("span",{class:"search-bar__icon"},"ðŸ”",-1)),A(e("input",{type:"text","onUpdate:modelValue":_[0]||(_[0]=S=>r.value=S),onInput:x,onKeydown:[q(m,["enter"]),q(b,["esc"])],placeholder:$.placeholder,class:"search-bar__input",ref_key:"inputRef",ref:y},null,40,ne),[[W,r.value]]),e("button",{onClick:m,class:"btn btn--primary btn--sm"},"Search")]))}},ae={class:"error-table-container"},re={class:"error-table"},ue={class:"w-10"},ie=["checked"],de=["onClick"],ce=["checked","onChange"],ve={class:"text-muted"},pe={class:"message-cell"},me={class:"badge badge--xs"},he={class:"text-muted"},fe={key:0,class:"assignee"},ge={key:1,class:"no-assignee"},_e={key:0,class:"empty-state"},ye={__name:"ErrorTable",props:{faults:{type:Array,default:()=>[]},oneHourCounts:{type:Object,default:()=>({})}},emits:["selection-change","status-update"],setup($,{emit:w}){const f=$,g=w,i=d(new Set),r=G(()=>f.faults.length>0&&i.value.size===f.faults.length),y=()=>{r.value?i.value.clear():f.faults.forEach(l=>i.value.add(l.id)),g("selection-change",Array.from(i.value))},x=l=>{i.value.has(l)?i.value.delete(l):i.value.add(l),g("selection-change",Array.from(i.value))},m=l=>{},b=(l,s)=>{g("status-update",{id:l,resolved:s})},a=(l,s)=>l?l.length>s?l.substring(0,s)+"...":l:"",_=l=>{if(!l)return"";const s=new Date(l),n=new Date-s,c=Math.floor(n/6e4),V=Math.floor(c/60),k=Math.floor(V/24);return c<1?"just now":c<60?`${c}m ago`:V<24?`${V}h ago`:`${k}d ago`},S=l=>f.oneHourCounts[l]||0;return(l,s)=>{const E=J("router-link");return p(),h("div",ae,[e("table",re,[e("thead",null,[e("tr",null,[e("th",ue,[e("input",{type:"checkbox",class:"table__checkbox",checked:r.value,onChange:y},null,40,ie)]),s[2]||(s[2]=e("th",null,"Error Type",-1)),s[3]||(s[3]=e("th",null,"Location",-1)),s[4]||(s[4]=e("th",null,"Message",-1)),s[5]||(s[5]=e("th",null,"Environment",-1)),s[6]||(s[6]=e("th",null,"1 Hour",-1)),s[7]||(s[7]=e("th",null,"Count",-1)),s[8]||(s[8]=e("th",null,"Last",-1)),s[9]||(s[9]=e("th",null,"Assignee",-1)),s[10]||(s[10]=e("th",null,"Status",-1))])]),e("tbody",null,[(p(!0),h(B,null,N($.faults,n=>(p(),h("tr",{key:n.id,class:U({"row-selected":i.value.has(n.id)}),onClick:c=>m(n.id)},[e("td",{onClick:s[0]||(s[0]=M(()=>{},["stop"]))},[e("input",{type:"checkbox",class:"table__checkbox",checked:i.value.has(n.id),onChange:c=>x(n.id)},null,40,ce)]),e("td",null,[P(E,{to:`/errors/${n.id}`,class:"error-link"},{default:X(()=>[F(v(n.error_class),1)]),_:2},1032,["to"])]),e("td",ve,v(n.location||"unknown"),1),e("td",pe,v(a(n.message,60)),1),e("td",null,[e("span",{class:U(["env-badge",`env-${n.environment}`])},v(n.environment),3)]),e("td",null,[e("span",{class:U(S(n.id)>0?"text-body":"text-muted")},v(S(n.id)),3)]),e("td",null,[e("span",me,v(n.occurrence_count),1)]),e("td",he,v(_(n.last_seen_at)),1),e("td",null,[n.assignee?(p(),h("span",fe,v(n.assignee.name||n.assignee.email),1)):(p(),h("span",ge,"â€”"))]),e("td",{onClick:s[1]||(s[1]=M(()=>{},["stop"]))},[P(se,{"model-value":n.resolved,"onUpdate:modelValue":c=>b(n.id,c)},null,8,["model-value","onUpdate:modelValue"])])],10,de))),128))])]),$.faults.length===0?(p(),h("div",_e,[...s[11]||(s[11]=[e("div",{class:"empty-state__icon"},"ðŸ“­",-1),e("div",{class:"empty-state__text"},"No errors found",-1)])])):R("",!0)])}}},be={class:"errors-page"},ke={class:"filter-bar mb-6"},we={class:"flex gap-2"},$e=["onClick"],Se={class:"filter-bar__group ml-auto"},Ce={class:"errors-content"},xe={key:0,class:"loading-spinner"},Ve={key:1,class:"card card--empty"},Ee={class:"card__text"},Ae={key:3,class:"pagination"},Ue=["disabled"],De={class:"pagination__info"},Pe=["disabled"],Re={__name:"Errors",setup($){const w=d(""),f=d("all"),g=d(""),i=d(""),r=d(""),y=d([]),x=d({}),m=d(0),b=d(50),a=d(0),_=d([]),S=d(null),l=d(!1),s=d(null),E=[{key:"all",label:"All"},{key:"resolved",label:"Resolved"},{key:"unresolved",label:"Unresolved"}],n=t=>{f.value=t,c()},c=async()=>{a.value=0,await k()},V=()=>{c()},k=async()=>{l.value=!0,s.value=null;try{const t=new URLSearchParams;t.append("limit",b.value.toString()),t.append("offset",a.value.toString()),w.value&&t.append("q",w.value),f.value==="resolved"?t.append("q",(t.get("q")||"")+" is:resolved"):f.value==="unresolved"&&t.append("q",(t.get("q")||"")+" -is:resolved"),g.value&&t.append("q",(t.get("q")||"")+` environment:${g.value}`);const o=await C(`/api/v1/faults?${t.toString()}`);y.value=o.faults||[],m.value=o.total||0,await L()}catch(t){console.error("Error loading faults:",t),s.value=t.message||"Failed to load errors",y.value=[],m.value=0}finally{l.value=!1}},L=async()=>{const t={};for(const o of y.value)try{const u=await C(`/api/v1/faults/${o.id}/stats`);t[o.id]=u.one_hour_count||0}catch{t[o.id]=0}x.value=t},O=t=>{_.value=t},H=async({id:t,resolved:o})=>{try{await C(`/api/v1/faults/${t}/${o?"resolve":"unresolve"}`,{method:"POST"}),await k()}catch(u){console.error("Error updating status:",u)}},I=async()=>{if(!r.value||_.value.length===0){r.value="";return}try{for(const t of _.value)r.value==="resolve"?await C(`/api/v1/faults/${t}/resolve`,{method:"POST"}):r.value==="unresolve"?await C(`/api/v1/faults/${t}/unresolve`,{method:"POST"}):r.value==="ignore"?await C(`/api/v1/faults/${t}/ignore`,{method:"POST"}):r.value==="delete"&&await C(`/api/v1/faults/${t}`,{method:"DELETE"});r.value="",_.value=[],await k()}catch(t){console.error("Error performing bulk action:",t)}},K=()=>{a.value>0&&(a.value-=b.value,k())},j=()=>{a.value+b.value<m.value&&(a.value+=b.value,k())},z=()=>{k()},T=t=>{var o;t.key==="/"&&t.target.tagName!=="INPUT"?(t.preventDefault(),(o=S.value)==null||o.focus()):t.key==="u"&&t.ctrlKey?(t.preventDefault(),n("unresolved")):t.key==="r"&&t.ctrlKey?(t.preventDefault(),n("resolved")):t.key==="a"&&t.ctrlKey&&(t.preventDefault(),n("all"))};return Y(()=>{k(),window.addEventListener("keydown",T)}),Z(()=>{window.removeEventListener("keydown",T)}),(t,o)=>(p(),h("div",be,[e("div",{class:"section__header mb-6"},[o[5]||(o[5]=e("h1",{class:"page-title mb-0"},"Errors",-1)),e("div",{class:"flex gap-2"},[e("button",{class:"btn btn--primary",onClick:z},[...o[4]||(o[4]=[e("span",null,"â†»",-1),F(" Refresh ",-1)])])])]),e("div",ke,[P(le,{modelValue:w.value,"onUpdate:modelValue":o[0]||(o[0]=u=>w.value=u),onSearch:V,ref_key:"searchBarRef",ref:S,placeholder:"Search errors..."},null,8,["modelValue"]),e("div",we,[(p(),h(B,null,N(E,u=>e("button",{key:u.key,class:U(["btn btn--sm",f.value===u.key?"btn--brand":"btn--ghost"]),onClick:Te=>n(u.key)},v(u.label),11,$e)),64))]),e("div",Se,[A(e("select",{"onUpdate:modelValue":o[1]||(o[1]=u=>g.value=u),onChange:c,class:"filter-bar__select"},[...o[6]||(o[6]=[e("option",{value:""},"Any Environment",-1),e("option",{value:"production"},"Production",-1),e("option",{value:"staging"},"Staging",-1),e("option",{value:"development"},"Development",-1)])],544),[[D,g.value]]),A(e("select",{"onUpdate:modelValue":o[2]||(o[2]=u=>i.value=u),onChange:c,class:"filter-bar__select"},[...o[7]||(o[7]=[e("option",{value:""},"Any Assignee",-1),e("option",{value:"me"},"Me",-1)])],544),[[D,i.value]]),A(e("select",{"onUpdate:modelValue":o[3]||(o[3]=u=>r.value=u),onChange:I,class:"filter-bar__select"},[...o[8]||(o[8]=[ee('<option value="">Bulk Actions</option><option value="resolve">Resolve</option><option value="unresolve">Unresolve</option><option value="ignore">Ignore</option><option value="delete">Delete</option>',5)])],544),[[D,r.value]])])]),e("div",Ce,[l.value?(p(),h("div",xe,[...o[9]||(o[9]=[e("div",{class:"spinner"},null,-1)])])):s.value?(p(),h("div",Ve,[o[10]||(o[10]=e("div",{class:"card__icon"},"âš ï¸",-1)),e("div",Ee,v(s.value),1),e("button",{onClick:k,class:"btn btn--primary"},"Retry")])):(p(),te(ye,{key:2,faults:y.value,"one-hour-counts":x.value,onSelectionChange:O,onStatusUpdate:H},null,8,["faults","one-hour-counts"])),m.value>0?(p(),h("div",Ae,[e("button",{class:"pagination__btn",disabled:a.value===0,onClick:K}," â† Previous ",8,Ue),e("span",De," Showing "+v(a.value+1)+" to "+v(Math.min(a.value+b.value,m.value))+" of "+v(m.value),1),e("button",{class:"pagination__btn",disabled:a.value+b.value>=m.value,onClick:j}," Next â†’ ",8,Pe)])):R("",!0)])]))}};export{Re as default};
